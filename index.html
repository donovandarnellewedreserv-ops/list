<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Invitation — Darnelle & Donovan</title>
  <style>
    :root{
      --bg:#fbf6f0;
      --accent:#b37c00;
      --muted:#7a6b5f;
      --card-bg: #fffaf6;
      --maxw:900px;
    }
    html,body{height:100%;margin:0;font-family: "Georgia", "Times New Roman", serif;background:linear-gradient(180deg,#ffffff 0%, #fbfbfb 60%);color:#6a563f}
    .wrap{max-width:var(--maxw);margin:36px auto;padding:20px;}
    .card{background:var(--card-bg);border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.08);padding:28px; border:1px solid rgba(180,140,90,0.12)}
    h1.title{font-family: "Palace Script","Times New Roman",serif;font-size:44px;color:var(--accent);text-align:center;margin:6px 0 18px}
    .center{text-align:center}
    label{display:block;margin:8px 0 4px;font-weight:600;color:var(--muted)}
    input[type="text"]{width:100%;padding:10px;border-radius:6px;border:1px solid #e5d8c9;font-size:16px;box-sizing:border-box}
    button{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:8px;font-weight:600;cursor:pointer;margin-top:12px}
    button.secondary{background:#e9dfd4;color:#6a563f}
    .hidden{display:none}
    .message{padding:12px;border-radius:8px;margin-top:12px}
    .msg-ok{background:#eaf5ea;color:#2f6f33}
    .msg-no{background:#fdecea;color:#8a2b2b}
    /* sections */
    .stage{display:none}
    .stage.active{display:block}
    /* invitation card styling (simple) */
    .invite-card{padding:20px;border-radius:10px;border:1px solid rgba(160,130,80,0.12);background:#fffefb}
    .invite-names{font-family: "Palace Script", "Georgia", serif;font-size:40px;color:var(--accent);text-align:center;margin:10px 0}
    .invite-text{color:#6a563f;text-align:center;font-size:18px;line-height:1.6}
    /* image protection */
    .image-protect{position:relative;display:inline-block}
    .image-protect img{display:block;max-width:100%;height:auto;border-radius:8px;user-select:none;-webkit-user-drag:none}
    .image-protect .overlay{position:absolute;inset:0;background:transparent}
    /* RSVP area */
    .rsvp{padding:14px;background:#fff;border-radius:8px;margin-top:12px}
    .small{font-size:14px;color:#6a563f}
    footer.note{margin-top:18px;font-size:13px;color:#9a8570;text-align:center}
    @media (min-width:880px){
      .wrap{padding:36px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="mainCard">
      <h1 class="title">Darnelle & Donovan</h1>

      <!-- Stage 1: Entrer le nom -->
      <section id="stage-1" class="stage active">
        <p class="center invite-text">Veuillez entrer votre nom complet pour vérifier si vous êtes invité·e :</p>
        <label for="fullname">Nom complet</label>
        <input id="fullname" type="text" placeholder="Ex. Isaac Admeus" autocomplete="off" />
        <div style="display:flex;gap:12px;align-items:center;">
          <button id="checkBtn">Vérifier</button>
          <button id="resetBtn" class="secondary">Effacer</button>
        </div>
        <div id="status" class="hidden message"></div>
      </section>

      <!-- Stage 2: Félicitations + bouton Continuer -->
      <section id="stage-2" class="stage">
        <div id="congrats" class="message msg-ok">
          <strong>Félicitations !</strong>
          <p id="congratsName" style="margin:6px 0 0"></p>
          <p style="margin:6px 0 0">Vous faites partie des invité·e·s du mariage de Donovan et Darnelle.</p>
        </div>
        <div style="text-align:center;margin-top:12px;">
          <button id="toInvite">Continuer</button>
        </div>
      </section>

      <!-- Stage 3: Invitation visible -->
      <section id="stage-3" class="stage">
        <div class="invite-card">
          <div class="invite-text">Dans le silence d'une prière et la douceur d'une promesse,<br> deux cœurs ont choisi de ne faire qu'un.</div>
          <div class="invite-names">Darnelle & Donovan</div>
          <div class="invite-text">
            <div>Le dimanche 29 Mars 2026, à l'Église Adventiste Philadelphie, Laboule 15 à 11h am.</div>
          </div>
        </div>

        <div style="text-align:center;margin-top:12px;">
          <button id="toDress">Continuer</button>
        </div>
      </section>

      <!-- Stage 4: Dress code image (non téléchargeable) -->
      <section id="stage-4" class="stage center">
        <p class="invite-text">Merci de respecter le dresscode printanier conseillé :</p>

        <div class="image-protect" style="max-width:640px;margin:14px auto;">
          <!-- Remplace src par ton image dans /assets/dresscode.jpg -->
          <img id="dressImg" src="assets/dresscode.jpg" alt="Dress code — palette de couleurs" />
          <div class="overlay" title="Image protégée (clic droit désactivé)"></div>
        </div>

        <div style="text-align:center;">
          <button id="toRsvp">Continuer</button>
        </div>
      </section>

      <!-- Stage 5: Carte RSVP (confirmation) -->
      <section id="stage-5" class="stage">
        <div class="rsvp">
          <h3 style="margin-top:0;color:var(--accent);font-family: 'Palace Script', serif">Confirmation de présence</h3>
          <p class="small">Merci de confirmer votre présence avant le 14 Mars 2026.</p>
          <div style="margin-top:8px;">
            <label for="attend" class="small">Je serai présent·e :</label>
            <div style="display:flex;gap:10px;margin-top:8px;">
              <button id="btnYes">Oui, je confirme</button>
              <button id="btnNo" class="secondary">Non, je ne pourrai pas venir</button>
            </div>
          </div>
          <div id="rsvpResult" class="message hidden" style="margin-top:12px"></div>
        </div>

        <footer class="note">Merci — Donovan & Darnelle</footer>
      </section>

    </div>
  </div>

  <script>
    // UTIL : Normalisation du nom
    function normalizeName(s){
      return s.trim().replace(/\s+/g, ' ').toLowerCase();
    }

    // Chargement de la liste d'invités (guests.json)
    let allowedNames = [];
    async function loadGuests(){
      try{
        const r = await fetch('guests.json', {cache: "no-store"});
        if(!r.ok) throw new Error('Impossible de charger guests.json');
        const data = await r.json();
        if(Array.isArray(data.guests)){
          allowedNames = data.guests.map(n => normalizeName(n));
        } else {
          console.warn('Format guests.json inattendu');
        }
      } catch(e){
        console.warn('Erreur en chargeant guests.json:', e);
      }
    }

    // initial load
    loadGuests();

    // DOM
    const el = id=>document.getElementById(id);
    const stages = ['stage-1','stage-2','stage-3','stage-4','stage-5'];
    function showStage(name){
      stages.forEach(s=>el(s).classList.toggle('active', s===name));
      // Scroll top to card
      window.scrollTo({top:0,behavior:'smooth'});
    }

    // elements
    const fullname = el('fullname');
    const checkBtn = el('checkBtn');
    const resetBtn = el('resetBtn');
    const status = el('status');
    const congratsName = el('congratsName');
    const toInvite = el('toInvite');
    const toDress = el('toDress');
    const toRsvp = el('toRsvp');
    const btnYes = el('btnYes');
    const btnNo = el('btnNo');
    const rsvpResult = el('rsvpResult');

    // Check function
    function checkName(){
      const v = fullname.value || '';
      const norm = normalizeName(v);
      if(!norm){
        status.className = 'message msg-no';
        status.textContent = 'Veuillez entrer votre nom complet.';
        status.classList.remove('hidden');
        return;
      }
      // reload guests if empty (in case)
      if(allowedNames.length === 0){
        // small attempt to reload
        loadGuests().then(()=>{
          validate(norm,v);
        });
      } else {
        validate(norm,v);
      }
    }

    function validate(norm,v){
      const found = allowedNames.includes(norm);
      if(found){
        // success
        status.classList.add('hidden');
        congratsName.textContent = v;
        showStage('stage-2');
      } else {
        status.className = 'message msg-no';
        status.textContent = `Désolé, "${v}" ne figure pas sur la liste des invité·e·s. Si vous pensez que c'est une erreur, contactez les organisateurs.`;
        status.classList.remove('hidden');
      }
    }

    // Handlers
    checkBtn.addEventListener('click', checkName);
    resetBtn.addEventListener('click', ()=>{ fullname.value=''; status.classList.add('hidden'); fullname.focus(); });
    fullname.addEventListener('keydown', (e)=>{ if(e.key==='Enter') checkBtn.click() });

    toInvite.addEventListener('click', ()=> showStage('stage-3'));
    toDress.addEventListener('click', ()=> showStage('stage-4'));
    toRsvp.addEventListener('click', ()=> showStage('stage-5'));

    // RSVP handling (simple UI; tu peux modifier pour envoyer au serveur)
    btnYes.addEventListener('click', ()=>{
      rsvpResult.className = 'message msg-ok';
      rsvpResult.textContent = 'Merci — votre présence a bien été enregistrée (localement).';
      rsvpResult.classList.remove('hidden');
    });
    btnNo.addEventListener('click', ()=>{
      rsvpResult.className = 'message msg-no';
      rsvpResult.textContent = 'Merci de nous avoir prévenu. Nous sommes tristes de vous manquer.';
      rsvpResult.classList.remove('hidden');
    });

    // Protection des images côté client (désactivation clic droit, dragstart, ctrl+s)
    document.addEventListener('contextmenu', function(e){
      // Empêche le menu contextuel pour toute la page (protection basique)
      e.preventDefault();
    });
    document.addEventListener('keydown', function(e){
      // Bloque Ctrl+S / Cmd+S / Ctrl+P et F12 / Ctrl+Shift+I
      if((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'S' || e.key === 'p' || e.key === 'P')) {
        e.preventDefault();
      }
      if((e.ctrlKey || e.metaKey) && e.shiftKey && (e.key === 'I' || e.key === 'i')) e.preventDefault();
    });
    // Empêche drag d'image
    document.addEventListener('dragstart', function(e){
      if(e.target && e.target.tagName === 'IMG') e.preventDefault();
    });

    // Overlay capture prevention: l'overlay couvre l'image ; on empêche aussi le clic droit dessus
    document.addEventListener('DOMContentLoaded', ()=>{
      // si l'image est manquante, on affiche un texte d'information
      const dressImg = el('dressImg');
      dressImg.addEventListener('error', ()=> {
        dressImg.style.display = 'none';
        const p = document.createElement('p');
        p.textContent = 'Image du dresscode introuvable. Ajoutez "assets/dresscode.jpg" dans le dépôt pour l\'afficher.';
        p.style.color = '#7a6657';
        p.style.fontStyle = 'italic';
        p.style.marginTop = '10px';
        dressImg.parentElement.appendChild(p);
      });
    });

    // Conseils : empêcher l'accès si nom absent — déjà fait.
  </script>
</body>
</html>
